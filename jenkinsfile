//start of the Jenkinsfile

pipeline {
    
    // Agent Any means : this pipeline can be used for any Jenkins 
    agent any

    tools {
            // Define Maven tool with specific installation name and version
            maven 'Maven' 
        }

    //Scripts to be used for every stages of a pipeline
    stages {
        
        //define the stages one by one. a pipelinbe can have as many as stages you want.
        stage('Build') {
            steps {
                // Run Maven build
                sh 'mvn clean package'
            }
        }
        stage('Test') {
            steps {
                // Run Maven tests
                sh 'mvn test'
            }
        }
        stage('send jar file') {
            steps {
                sh 'scp -i /hattoum.pem  /var/jenkins_home/workspace/devops-pipeline-project_main/target/jenking-pipe-java-0.0.1-SNAPSHOT.jar  ubuntu@ec2-44-204-174-183.compute-1.amazonaws.com:/'

            }
        }
        stage("deploy") {
            steps {
                echo "Now deploying the applicaiton version"
                sh 'ssh -i /hattoum.pem ubuntu@ec2-44-204-174-183.compute-1.amazonaws.com'
                sh 'java -jar your_jar_file.jar --port=8099' 
                sh 'exit'
                }
            }


    }

        post {
        always {

            emailext body: 'A Test EMail', recipientProviders: [[$class: 'DevelopersRecipientProvider'], [$class: 'RequesterRecipientProvider']], subject: 'Test'
        }
    }


    //Post Expression : execute some logics after all of the stages are executed.
    //Can be used to email build results to the developers.

} 